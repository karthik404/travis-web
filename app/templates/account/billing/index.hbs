{{!FIXME remove this}}
<div id='billing-panel'>
  {{#if model}}
    <button {{action (mut model) null}}>Delete subscription</button>
  {{/if}}
  Source:
  <ul>
    <li><button {{action (mut model.source) 'manual'}}>manual</button></li>
    <li><button {{action (mut model.source) 'stripe'}}>stripe</button></li>
    <li><button {{action (mut model.source) 'github'}}>marketplace</button></li>
  </ul>
  Status:
  <ul>
    <li><button {{action (mut model.status) 'subscribed'}}>subscribed</button></li>
    <li><button {{action (mut model.status) 'canceled'}}>canceled</button></li>
    <li><button {{action (mut model.status) 'expired'}}>expired</button></li>
  </ul>
  Subscription write permission:
  <ul>
    <li><button {{action (mut model.permissions.write) true}}>true</button></li>
    <li><button {{action (mut model.permissions.write) false}}>false</button></li>
  </ul>
  Subscription create permission: (no API support yet)
  <ul>
    <li><button {{action (mut account.subscriptionPermissions.create) true}}>true</button></li>
    <li><button {{action (mut account.subscriptionPermissions.create) false}}>false</button></li>
  </ul>
</div>

<section class='billing'>
  {{#unless model}}
    {{new-subscription-button account=account}}
  {{/unless}}
  {{#if model.manageSubscription}}
    {{manage-subscription-button subscription=model account=account}}
  {{/if}}
  {{#if model.isSubscribed}}
    {{#unless model.isManual}}
      <h2>Plan Overview</h2>
      <section class='plan'>
        <h3 data-test-plan-name>{{model.plan.name}}</h3>
        <p data-test-plan-concurrency>{{pluralize model.plan.builds 'concurrent build'}}</p>
        <p>Valid through {{moment-format model.validTo 'MMMM D, YYYY'}}</p>
      </section>
    {{/unless}}
    <h2>Billing Information</h2>
    <section class='row'>
      {{#if model.isStripe}}
        <section class='contact'>
          <h3>Billing Contact</h3>
          {{billing-address billingInfo=model.billingInfo}}
        </section>
      {{/if}}
      <section class='payment'>
        <h3>Payment details</h3>
        {{payment-details subscription=model helpscoutTrigger=(action 'helpscoutTrigger')}}
      </section>
    </section>
  {{else if model}}
    <span data-test-expiry-message>
      {{#if model.isExpired}}
        You had a {{model.sourceWords}} subscription that expired on {{moment-format model.validTo 'MMMM D, YYYY'}}.
      {{else}}
        This subscription has been canceled by you and is valid through {{moment-format model.validTo 'MMMM D, YYYY'}}.
      {{/if}}
      {{#if model.isManual}}
        <p class='manual-help'>
          If you have any questions or would like to update your plan, please
          <a href='{{ config.urls.support }}' title='Email the Travis support team' {{action 'helpscoutTrigger'}}>contact our support team</a>.
        </p>
      {{/if}}
    </span>
    {{#if model.isResubscribable}}
      {{resubscribe-button subscription=model account=account}}
    {{/if}}
    {{#if model.isGithub}}
      <a href={{config.marketplaceEndpoint}} class='button--blue marketplace-button'>Manage on GitHub Marketplace</a>
    {{/if}}
  {{/if}}
</section>

{{#if invoices}}
  <section class='invoices'>
    <h2>Invoice History</h2>
    <p>
      {{svg-jar 'icon-help' class='icon-help' alt=''}}
      Having trouble with your invoices?
      <a href='{{ config.urls.support }}' title='Email the Travis support team' {{action 'helpscoutTrigger'}}>Weâ€™re happy to help</a>.
    </p>
      <ul>
        {{#each (sort-by 'createdAt:desc' invoices) as |invoice|}}
          <li><a data-test-invoice href={{invoice.url}}>{{svg-jar 'icon-invoice' class='icon'}} {{invoice.id}} {{moment-format invoice.createdAt 'MMMM YYYY'}}</a></li>
        {{/each}}
      </ul>
  </section>
{{/if}}
